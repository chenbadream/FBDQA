# FBDQA第九次课程

## 正态性检验
- 股票对数收益率正态性的检验
- 许多重要的金融模型依赖于证券收益呈正态分布的假设

### 图形化方法——频率分布直方图、分位数-分位数图
- 画出待检验数据的频率分布直方图和正态分布进行对比
  - 用蒙特卡洛生成模拟的股票数据
  - 计算股票的对数收益率 
  - 看对数收益率分布是否与正态分布接近

### 分位数-分位数图
- statsmodels.qqplot函数
- 纵坐标是实际取值，横坐标是正态分布生成的数据的分位数
- 若散点和线很接近，说明数据分布接近正态分布
- 左侧三点低于线，右侧散点高于线，说明数据分布有“厚尾”（异常值较多）
- 左侧三点高于线，右侧散点低于线，说明数据分布比正态分布更“集中”

### 定量方法
- 测偏度和峰度
- 正态分布的偏度和峰度均为0，若样本的偏度、峰度接近0，则可以认为数据服从正态分布
- 假设检验法：偏度检验、风度检验、正态性检验，输出p值，若p值高于0.05，则说明数据服从正态分布（H0是样本服从正态分布，p值低是拒绝样本服从正态分布）

## 投资组合优化
- 对数收益率的正态分布是Markowitz投资组合理论的基础，正态分布意味着只用均值、方差可完整描述收益的分布。

### 有效边界的获取
- 有效边界：给定风险水平下最大化收益的投资组合构成的集合
- 蒙特卡洛模拟，随机生成较大规模的投资组合权重向量w。对于每一种模拟的权重，计算其预期投资组合收益、标准差、夏普比例
- 投资组合优化是一个约束最优化问题， 可以使用最优化方法来求有效边界。具体可以用scipy.optimize库的minimize函数求解

### 无风险投资的加入——资本市场线
资本市场线是现代投资组合理论中的一个重要概念，用来描述投资者在无风险资产和市场组合之间的最优组合。它反映了在同一风险水平下，投资者可以通过不同的资产配置获得的最高收益。

- 资本市场线的本质：CML是从无风险收益率 $R_f$开始，到市场组合 𝑀（有效边界的切点）形成的一条直线。
- 线上的任意一点都表示无风险资产和市场组合的不同组合。
- 在引入无风险资产后，投资者可以通过将资金配置在无风险资产和有效边界上的投资组合之间，构建更优的投资组合。


资本市场线展示了在风险与收益之间的最优权衡，投资者可以根据风险偏好选择无风险资产和市场组合的最佳比例，形成不同的最优投资组合。它是构建多样化投资组合和理解市场收益结构的重要工具。

## CTA统计套利
- 统计套利核心原理：均值回归、大数定律
- 统计套利的好处：
  - 为市场提供了流动性，降低市场波动性
  - 成熟的市场是趋于低波动率的
  - 多空对冲，充分利用保证金
  - 收益稳定，回撤远低于单边策略
- 统计套利的潜在风险
  - 价差扩散长时间不收敛
  - 流动性危机，单边行情，可能空头会面临爆仓，保证金不足


### 统计基础
- 相关性，是指两个或多个变量之间相互关系的强弱和方向。在统计学中，相关性通常用来衡量一个变量随另一个变量的变化而变化的程度和方式。
- 皮尔逊相关性（Pearson Correlation）是一种用来衡量两个变量之间线性关系的统计方法。皮尔逊的 r 仅度量线性关系。即使存在非线性关系，相关性也可能很低甚至为零。

- 距离相关系数：距离相关性为零时，可以推断两个变量没有任何依赖关系，而不仅仅是没有线性关系。
- 斯皮尔曼秩相关系数，用于衡量两个变量之间的单调关系强度和方向，基于秩序比较。

#### 协整关系
- 两个非平稳的时间序列，如果他们的线性组合是平稳的，则这两个序列存在协整关系。
- 平稳：均值和方差不随时间变化。
##### 步骤1：检验平稳性（单位根检验）
- ADF（Augmented Dickey-Fuller）检验
- 如果有单位根，序列非稳定
- 如果无单位根，序列稳定

##### 步骤2：协整检验
- 当确认各序列是非平稳的后，可以通过协整检验来检测它们之间是否存在协整关系。
- Engle-Granger 两步检验：这是处理两个变量之间协整关系的最常用方法。选择一个变量作为因变量，另一个变量作为自变量，进行普通最小二乘回归（OLS）以得到回归残差。对残差序列进行单位根检验（如 ADF 检验）。如果残差序列是平稳的，则这两个时间序列存在协整关系。
- Johansen 检验：适用于多变量协整关系检测。Johansen 检验通过构建向量自回归模型（VAR），可以同时检测多个变量之间是否存在协整关系。
- 如果检测到协整关系，可以建立误差修正模型（Error Correction Model, ECM）来描述短期偏离和长期均衡之间的关系。
### 总结
- 协整关系检测帮助我们找到非平稳时间序列间的长期关系。
- Engle-Granger 两步检验适合两变量情况
- Johansen 检验适用于多变量情形。
- 检测出协整关系后，可以进一步构建误差修正模型，从而捕捉短期波动和长期均衡之间的互动


### 主流量化交易策略类型与实操框架

#### 量化多因子与股票多头
- 量化投资策略的多因子框架
- 主流量化投资策略，多因子，挖因子
- 股票型Alpha策略+指数增强：Alpha策略不需要依靠对证券组合或大盘的趋势判断，而是追求对冲系统风险后的绝对收益，即做到无论大盘涨跌都能赚钱。
- 配对套利：商品配对交易（Pairs Trading）是利用基本面分析和量化方法寻找同一产业链或板块中商品品种间价格波动相关规律，通过做多一个品种，同时做空另外一个配对品种的交易，获得相对稳定的价差波动收益。
- CTA策略：趋势跟随策略+套利策略
- 衍生品
    - 标准化场内期权交易
    - 箱体套利
    - 雪球产品
    - Delta Hedge
- 高频量化
    - 高频交易的经典模型
    - 线性模型，拼执行力
    - 波动率模型
    - 非线性模型

### 中性策略的实战探索

- 量化多因子的竞争格局
    - 传统因子：Alpha101
    - 卖方研究：各种花式因子挖掘
    - 买方研究：团队批量因子挖掘
    - 量化研究：更倾向于日内量价因子的挖掘
    - 高频领域：由因子到特征，牺牲可解释性，换取灵活性和快速适应性
    - 没有标准答案的问题：因子组合与投资组合优化

- 你以为的中性 
    - 纯粹的市值中性，无大小盘风格偏差
    - 纯粹的行业中性，至少一级行业无偏差
    - 不留多空敞口，完美对冲
    - 不择时，依靠选股获取超额
    vs. 你见到的中性
    - 经常依靠猜大小，也就是暴露市值风格获取超额收益
    - 经常暴露行业风格敞口来获取超额
    - 有意或无意暴露多空敞口
    - 也经常采用一些择时的手段

- 划重点：中性产品的长期超额来源
    - 常用的因子
    - 市值，估值，反转，盈利，成长，流动性等，要建立常规监测机制（监测这些因子的拥挤度，拥挤的地方不要去），根据不同因子拥挤度来调整因子权重
    - 投资人教育
    - 合理的规模
    - 量化与主动投资的结合，精研一些个股，90头寸机器化，10头寸10支票，有些感觉是不能程序化，还有第一手信息是不能程序化的
    - 风格轮动的重要性，a股市场行业轮动很快，收益也很重要，中性策略还是要严控一级行业。行业内部选股
    - 市场择时，多空敞口百分之2，3用于市场择时，放十几个点就太多了。
    - 灵魂思考：何为中性？降低净值波动的情况下，获取显著超越市场无风险利率的收益
